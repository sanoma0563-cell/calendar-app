<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>誕生日キャラ 日干支カレンダー（スマホ版）</title>

<style>
  body {
    font-family: "Noto Sans JP", sans-serif;
    margin: 0;
    padding: 14px;
    background: #f7fbfc;
    color: #111;
  }

  h1 {
    font-size: 18px;
    margin: 0 0 6px;
    text-align: center;
  }

  p.lead {
    margin: 4px 0 14px;
    color: #444;
    font-size: 14px;
    text-align: center;
  }

  /* 入力エリア */
  .controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 16px;
  }

  label {
    font-size: 13px;
    color: #333;
  }

  input[type="date"],
  input[type="number"] {
    width: 100%;
    padding: 11px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    font-size: 15px;
  }

  .btn-row {
    display: flex;
    gap: 10px;
    justify-content: space-between;
  }

  button {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: 0;
    font-size: 15px;
    font-weight: 600;
    background: #2563eb;
    color: #fff;
    cursor: pointer;
  }

  button.secondary {
    background: #64748b;
  }

  #info {
    font-size: 13px;
    margin-bottom: 14px;
    color: #333;
    text-align: center;
  }

  /* カード型カレンダー */
  #tableWrapper {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .card {
    background: #fff;
    padding: 14px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(2,6,23,0.1);
    font-size: 14px;
  }

  .date-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-weight: 600;
  }

  .sunday { color: #c0262e; }
  .saturday { color: #1e40af; }
  .today {
    background: #fff2e0 !important;
    border-left: 6px solid #f97316;
  }

  .label { font-weight: bold; margin-right: 6px; }

  @media (min-width: 750px) {
    body { max-width: 680px; margin: 20px auto; }
    h1 { font-size: 22px; }
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>

<h1>誕生日キャラクター日干支カレンダー</h1>
<p class="lead">基準日：<strong>2025-10-22（甲子）</strong></p>

<div class="controls">
  <div>
    <label>誕生日</label>
    <input id="birth" type="date" />
  </div>

  <div>
    <label>表示日数</label>
    <input id="days" type="number" min="1" value="61" />
  </div>

  <div class="btn-row">
    <button id="btnGenerate">作成</button>
    <button id="btnDownload" class="secondary">Excel</button>
  </div>
</div>

<div id="info">誕生日を入力してください。</div>
<div id="tableWrapper"></div>


<script>
// ---------- 元のロジックはそのまま ----------
const stems=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
const branches=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
const jpWeek=["日","月","火","水","木","金","土"];

const kanInfo={
  "甲":["木","陽"],"乙":["木","陰"],"丙":["火","陽"],"丁":["火","陰"],
  "戊":["土","陽"],"己":["土","陰"],"庚":["金","陽"],"辛":["金","陰"],
  "壬":["水","陽"],"癸":["水","陰"]
};
const elementRelations={
  "木":{生:"火",剋:"土"},
  "火":{生:"土",剋:"金"},
  "土":{生:"金",剋:"水"},
  "金":{生:"水",剋:"木"},
  "水":{生:"木",剋:"火"}
};
const characterMap={
  "same-比和-same":"ストレート",
  "same-相生-same":"イノセント",
  "diff-比和-diff":"ハーモニー",
  "diff-相生-diff":"フォーカス",
  "same-剋す-same":"ハートフル",
  "diff-剋す-diff":"リアリティ",
  "same-剋される-same":"スピード",
  "same-生じられる-same":"ユニーク",
  "diff-剋される-diff":"プライド",
  "diff-生じられる-diff":"セオリー"
};
const comments={
  "ストレート":"素直に感情が出る。率直な表現が吉。",
  "イノセント":"純粋な行動が評価される。",
  "ハーモニー":"人と調和して良縁を得る。",
  "フォーカス":"集中力が高まる。目標に一直線。",
  "ハートフル":"情熱的に動ける。思いやりも大切に。",
  "リアリティ":"現実的判断が冴える。",
  "スピード":"判断が速い。",
  "ユニーク":"個性が光る。",
  "プライド":"誇りを守る。",
  "セオリー":"基本を守ると安定。"
};

const referenceDate = new Date("2025-10-22T00:00:00+09:00");
function floorMod(a,b){ return ((a % b) + b) % b; }

function tokyoMidnightFromDate(d){
  const s = d.toLocaleString('en-US',{timeZone:'Asia/Tokyo'});
  const tok = new Date(s);
  return new Date(tok.getFullYear(),tok.getMonth(),tok.getDate());
}
function formatDate(d){
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}
function ganzhiForDate(date){
  const delta = Math.floor((date - referenceDate)/86400000);
  return stems[floorMod(delta,10)] + branches[floorMod(delta,12)];
}
function dayStemForDate(date){
  const delta = Math.floor((date - referenceDate)/86400000);
  return stems[floorMod(delta,10)];
}
function getRelation(myEl, otherEl){
  if(myEl===otherEl) return "比和";
  if(elementRelations[myEl].生===otherEl) return "相生";
  if(elementRelations[otherEl].生===myEl) return "生じられる";
  if(elementRelations[myEl].剋===otherEl) return "剋す";
  if(elementRelations[otherEl].剋===myEl) return "剋される";
  return "なし";
}
function getCharacter(myKan, otherKan){
  const [myEl,myYin]=kanInfo[myKan];
  const [el,yin]=kanInfo[otherKan];
  const rel=getRelation(myEl,el);
  const yinType=myYin===yin?"same":"diff";
  const key=`${yinType}-${rel}-${yinType}`;
  return {char: characterMap[key]||"不明", rel, el, yin, comment: comments[characterMap[key]]||""};
}

let tableData=[];

function generateCalendar(birthStr, days){
  if(!birthStr){ alert("誕生日を入力してください"); return; }
  const birthTokyo = tokyoMidnightFromDate(new Date(birthStr));
  const myDayKan = dayStemForDate(birthTokyo);

  document.getElementById("info").textContent = `あなたの日干は「${myDayKan}」です。`;

  const today = tokyoMidnightFromDate(new Date());
  const rows=[];
  for(let i=0;i<days;i++){
    const d = new Date(today);
    d.setDate(today.getDate()+i);
    const tok = tokyoMidnightFromDate(d);
    const dateStr = formatDate(tok);
    const gz = ganzhiForDate(tok);
    const info = getCharacter(myDayKan, gz[0]);

    rows.push({
      日付: tok,
      日付表示: dateStr,
      曜日: jpWeek[tok.getDay()],
      日干支: gz,
      関係: info.rel,
      キャラ: info.char,
      コメント: info.comment
    });
  }

  tableData = rows;
  renderCards(rows, formatDate(today));
}

function renderCards(rows, todayStr){
  const wrap=document.getElementById("tableWrapper");
  wrap.innerHTML="";

  rows.forEach(r=>{
    const card=document.createElement("div");
    card.className="card";

    if(r.日付表示===todayStr) card.classList.add("today");
    if(r.曜日==="日") card.classList.add("sunday");
    if(r.曜日==="土") card.classList.add("saturday");

    card.innerHTML = `
      <div class="date-row">
        <div>${r.日付表示}</div>
        <div>${r.曜日}</div>
      </div>

      <div><span class="label">日干支：</span>${r.日干支}</div>
      <div><span class="label">関係：</span>${r.関係}</div>
      <div><span class="label">キャラ：</span>${r.キャラ}</div>
      <div><span class="label">コメント：</span>${r.コメント}</div>
    `;
    wrap.appendChild(card);
  });
}

// Excel出力
function downloadExcel(){
  if(!tableData.length){ alert("先に作成してください"); return; }
  const aoa=[["日付","曜日","日干支","関係","キャラ","コメント"]];
  tableData.forEach(r=>aoa.push([r.日付,r.曜日,r.日干支,r.関係,r.キャラ,r.コメント]));

  const ws=XLSX.utils.aoa_to_sheet(aoa);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"data");
  XLSX.writeFile(wb,"calendar.xlsx");
}

// ボタン
document.getElementById("btnGenerate").onclick=()=>{
  const birth=document.getElementById("birth").value;
  const days=parseInt(document.getElementById("days").value)||61;
  generateCalendar(birth,days);
};
document.getElementById("btnDownload").onclick=downloadExcel;

</script>
</body>
</html>
